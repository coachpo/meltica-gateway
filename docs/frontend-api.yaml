openapi: 3.1.0
info:
  title: Meltica Control Plane API
  version: "2025-11-08"
  description: >-
    REST endpoints exposed by the Meltica gateway for managing JavaScript strategies,
    runtime instances, providers, adapters, risk controls, and operational tools.
servers:
  - url: http://localhost:8880
    description: Default local control-plane endpoint
tags:
  - name: Strategies
  - name: Strategy Modules
  - name: Modules
  - name: Instances
  - name: Providers
  - name: Adapters
  - name: Risk
  - name: Context
  - name: Outbox
paths:
  /strategies:
    get:
      tags: [Strategies]
      summary: List available strategies
      operationId: listStrategies
      responses:
        '200':
          description: Strategy catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyListResponse'
        default:
          $ref: '#/components/responses/Error'
  /strategies/{name}:
    get:
      tags: [Strategies]
      summary: Retrieve a single strategy by identifier
      operationId: getStrategy
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
          description: Canonical strategy identifier
      responses:
        '200':
          description: Strategy metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Strategy'
        '404':
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /strategies/modules:
    get:
      tags: [Strategy Modules]
      summary: List JavaScript strategy modules available to the runtime
      operationId: listStrategyModules
      parameters:
        - in: query
          name: strategy
          schema:
            type: string
          description: Filter by strategy identifier
        - in: query
          name: hash
          schema:
            type: string
          description: Filter by revision hash
        - in: query
          name: runningOnly
          schema:
            type: boolean
          description: When true, only return modules that currently power running instances
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
          description: Maximum number of modules to return
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
          description: Offset into the filtered module set
      responses:
        '200':
          description: Strategy module listing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyModulesResponse'
        default:
          $ref: '#/components/responses/Error'
    post:
      tags: [Strategy Modules]
      summary: Upload or register a new strategy module revision
      operationId: createStrategyModule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StrategyModulePayload'
      responses:
        '201':
          description: Module staged and awaiting refresh
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyModuleOperationResponse'
        default:
          $ref: '#/components/responses/Error'
  /strategies/modules/{selector}:
    parameters:
      - in: path
        name: selector
        required: true
        schema:
          type: string
        description: Strategy name, name:tag, or name@hash identifying the module
    get:
      tags: [Strategy Modules]
      summary: Fetch metadata for a specific module selector
      operationId: getStrategyModule
      responses:
        '200':
          description: Module summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyModuleSummary'
        default:
          $ref: '#/components/responses/Error'
    put:
      tags: [Strategy Modules]
      summary: Update an existing module revision
      operationId: updateStrategyModule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StrategyModulePayload'
      responses:
        '200':
          description: Module updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyModuleOperationResponse'
        default:
          $ref: '#/components/responses/Error'
    delete:
      tags: [Strategy Modules]
      summary: Remove a module revision
      operationId: deleteStrategyModule
      responses:
        '204':
          description: Module removed
        default:
          $ref: '#/components/responses/Error'
  /strategies/modules/{selector}/source:
    get:
      tags: [Strategy Modules]
      summary: Download the raw JavaScript source for a module
      operationId: getStrategyModuleSource
      parameters:
        - in: path
          name: selector
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Module source contents
          content:
            application/javascript:
              schema:
                type: string
        default:
          $ref: '#/components/responses/Error'
  /strategies/modules/{selector}/usage:
    get:
      tags: [Strategy Modules]
      summary: Inspect runtime usage for a module revision
      operationId: getStrategyModuleUsage
      parameters:
        - in: path
          name: selector
          required: true
          schema:
            type: string
        - in: query
          name: includeStopped
          schema:
            type: boolean
          description: Include dormant instances that still pin the revision
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
      responses:
        '200':
          description: Usage and instance summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyModuleUsageResponse'
        default:
          $ref: '#/components/responses/Error'
  /strategies/refresh:
    post:
      tags: [Strategies]
      summary: Reload strategies from disk, optionally targeting specific hashes
      operationId: refreshStrategies
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StrategyRefreshRequest'
      responses:
        '200':
          description: Refresh status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyRefreshResponse'
        default:
          $ref: '#/components/responses/Error'
  /strategies/registry:
    get:
      tags: [Strategies]
      summary: Export registry.json merged with live usage
      operationId: exportStrategyRegistry
      responses:
        '200':
          description: Registry export
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StrategyRegistryExport'
        default:
          $ref: '#/components/responses/Error'
  /providers:
    get:
      tags: [Providers]
      summary: List provider runtimes
      operationId: listProviders
      responses:
        '200':
          description: Provider metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProvidersResponse'
        default:
          $ref: '#/components/responses/Error'
    post:
      tags: [Providers]
      summary: Create a provider
      operationId: createProvider
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProviderRequest'
      responses:
        '202':
          description: Provider accepted for creation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderDetail'
        default:
          $ref: '#/components/responses/Error'
  /providers/{name}:
    parameters:
      - in: path
        name: name
        required: true
        schema:
          type: string
    get:
      tags: [Providers]
      summary: Fetch a provider
      operationId: getProvider
      responses:
        '200':
          description: Provider detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderDetail'
        default:
          $ref: '#/components/responses/Error'
    put:
      tags: [Providers]
      summary: Update a provider
      operationId: updateProvider
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProviderRequest'
      responses:
        '200':
          description: Provider updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderDetail'
        default:
          $ref: '#/components/responses/Error'
    delete:
      tags: [Providers]
      summary: Remove a provider
      operationId: deleteProvider
      responses:
        '200':
          description: Provider removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  name:
                    type: string
        default:
          $ref: '#/components/responses/Error'
  /providers/{name}/start:
    post:
      tags: [Providers]
      summary: Start a provider asynchronously
      operationId: startProvider
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Provider start requested
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderDetail'
        default:
          $ref: '#/components/responses/Error'
  /providers/{name}/stop:
    post:
      tags: [Providers]
      summary: Stop a provider
      operationId: stopProvider
      parameters:
        - $ref: '#/components/parameters/ProviderName'
      responses:
        '200':
          description: Provider stopped
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderDetail'
        default:
          $ref: '#/components/responses/Error'
  /providers/{name}/balances:
    get:
      tags: [Providers]
      summary: Retrieve provider balance snapshots
      operationId: listProviderBalances
      parameters:
        - $ref: '#/components/parameters/ProviderName'
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
          description: Maximum number of balances to return
        - in: query
          name: asset
          schema:
            type: string
          description: Filter by asset ticker
      responses:
        '200':
          description: Provider balances
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceHistoryResponse'
        default:
          $ref: '#/components/responses/Error'
  /adapters:
    get:
      tags: [Adapters]
      summary: List registered adapters
      operationId: listAdapters
      responses:
        '200':
          description: Adapter metadata listing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdaptersResponse'
        default:
          $ref: '#/components/responses/Error'
  /adapters/{identifier}:
    get:
      tags: [Adapters]
      summary: Retrieve adapter metadata
      operationId: getAdapter
      parameters:
        - in: path
          name: identifier
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Adapter metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdapterMetadata'
        default:
          $ref: '#/components/responses/Error'
  /strategy/instances:
    get:
      tags: [Instances]
      summary: List strategy instances
      operationId: listInstances
      responses:
        '200':
          description: Instance list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstancesResponse'
        default:
          $ref: '#/components/responses/Error'
    post:
      tags: [Instances]
      summary: Create a strategy instance
      operationId: createInstance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceSpec'
      responses:
        '201':
          description: Instance created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceSpec'
        default:
          $ref: '#/components/responses/Error'
  /strategy/instances/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
    get:
      tags: [Instances]
      summary: Fetch an instance snapshot
      operationId: getInstance
      responses:
        '200':
          description: Instance snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceSpec'
        default:
          $ref: '#/components/responses/Error'
    put:
      tags: [Instances]
      summary: Update an instance
      operationId: updateInstance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceSpec'
      responses:
        '200':
          description: Instance updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceSpec'
        default:
          $ref: '#/components/responses/Error'
    delete:
      tags: [Instances]
      summary: Delete an instance
      operationId: deleteInstance
      responses:
        '200':
          description: Instance removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  id:
                    type: string
        default:
          $ref: '#/components/responses/Error'
  /strategy/instances/{id}/start:
    post:
      tags: [Instances]
      summary: Start an instance
      operationId: startInstance
      parameters:
        - $ref: '#/components/parameters/InstanceId'
      responses:
        '200':
          description: Instance start response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceActionResponse'
        default:
          $ref: '#/components/responses/Error'
  /strategy/instances/{id}/stop:
    post:
      tags: [Instances]
      summary: Stop an instance
      operationId: stopInstance
      parameters:
        - $ref: '#/components/parameters/InstanceId'
      responses:
        '200':
          description: Instance stop response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceActionResponse'
        default:
          $ref: '#/components/responses/Error'
  /strategy/instances/{id}/orders:
    get:
      tags: [Instances]
      summary: List recent orders for an instance
      operationId: listInstanceOrders
      parameters:
        - $ref: '#/components/parameters/InstanceId'
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
        - in: query
          name: provider
          schema:
            type: string
        - in: query
          name: states
          schema:
            type: array
            items:
              type: string
          style: form
          explode: true
      responses:
        '200':
          description: Order history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderHistoryResponse'
        default:
          $ref: '#/components/responses/Error'
  /strategy/instances/{id}/executions:
    get:
      tags: [Instances]
      summary: List recent executions for an instance
      operationId: listInstanceExecutions
      parameters:
        - $ref: '#/components/parameters/InstanceId'
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
        - in: query
          name: provider
          schema:
            type: string
        - in: query
          name: orderId
          schema:
            type: string
      responses:
        '200':
          description: Execution history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionHistoryResponse'
        default:
          $ref: '#/components/responses/Error'
  /risk/limits:
    get:
      tags: [Risk]
      summary: Retrieve runtime risk limits
      operationId: getRiskLimits
      responses:
        '200':
          description: Risk limits
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Present when limits were updated in this response
                  limits:
                    $ref: '#/components/schemas/RiskConfig'
        default:
          $ref: '#/components/responses/Error'
    put:
      tags: [Risk]
      summary: Apply runtime risk limits
      operationId: updateRiskLimits
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RiskConfig'
      responses:
        '200':
          description: Updated risk limits
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  limits:
                    $ref: '#/components/schemas/RiskConfig'
        default:
          $ref: '#/components/responses/Error'
  /context/backup:
    get:
      tags: [Context]
      summary: Export providers, lambdas, and risk config
      operationId: exportContext
      responses:
        '200':
          description: Context backup payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextBackupPayload'
        default:
          $ref: '#/components/responses/Error'
    post:
      tags: [Context]
      summary: Restore providers, lambdas, and risk config from a backup
      operationId: restoreContext
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContextBackupPayload'
      responses:
        '200':
          description: Restore status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestoreContextResponse'
        default:
          $ref: '#/components/responses/Error'
  /outbox:
    get:
      tags: [Outbox]
      summary: List pending outbox events
      operationId: listOutbox
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 500
      responses:
        '200':
          description: Pending events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutboxListResponse'
        default:
          $ref: '#/components/responses/Error'
  /outbox/{id}:
    delete:
      tags: [Outbox]
      summary: Delete a pending outbox event
      operationId: deleteOutbox
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Event removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutboxDeleteResponse'
        default:
          $ref: '#/components/responses/Error'
components:
  parameters:
    InstanceId:
      in: path
      name: id
      required: true
      schema:
        type: string
    ProviderName:
      in: path
      name: name
      required: true
      schema:
        type: string
  responses:
    Error:
      description: Error response
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorPayload'
  schemas:
    StrategyConfig:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
        description:
          type: string
        default:
          nullable: true
        required:
          type: boolean
      required: [name, type, required]
    Strategy:
      type: object
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        tag:
          type: string
        config:
          type: array
          items:
            $ref: '#/components/schemas/StrategyConfig'
        events:
          type: array
          items:
            type: string
      required: [name, displayName, description, config, events]
    StrategyListResponse:
      type: object
      properties:
        strategies:
          type: array
          items:
            $ref: '#/components/schemas/Strategy'
      required: [strategies]
    StrategyModuleRevision:
      type: object
      properties:
        hash:
          type: string
        tag:
          type: string
        path:
          type: string
        size:
          type: integer
          format: int64
        retired:
          type: boolean
      required: [hash, path, size]
    ModuleRunningSummary:
      type: object
      properties:
        hash:
          type: string
        instances:
          type: array
          nullable: true
          items:
            type: string
        count:
          type: integer
        firstSeen:
          type: string
          format: date-time
          nullable: true
        lastSeen:
          type: string
          format: date-time
          nullable: true
      required: [hash, count]
    StrategyModuleSummary:
      type: object
      properties:
        name:
          type: string
        file:
          type: string
        path:
          type: string
        hash:
          type: string
        tag:
          type: string
        tags:
          type: array
          items:
            type: string
        tagAliases:
          type: object
          additionalProperties:
            type: string
        revisions:
          type: array
          items:
            $ref: '#/components/schemas/StrategyModuleRevision'
        running:
          type: array
          items:
            $ref: '#/components/schemas/ModuleRunningSummary'
        size:
          type: integer
          format: int64
        metadata:
          $ref: '#/components/schemas/Strategy'
      required: [name, file, path, hash, tags, size, metadata]
    StrategyModulesResponse:
      type: object
      properties:
        modules:
          type: array
          items:
            $ref: '#/components/schemas/StrategyModuleSummary'
        total:
          type: integer
        offset:
          type: integer
        limit:
          type: integer
          nullable: true
        strategyDirectory:
          type: string
      required: [modules]
    StrategyModulePayload:
      type: object
      properties:
        filename:
          type: string
        name:
          type: string
        tag:
          type: string
        aliases:
          type: array
          items:
            type: string
        promoteLatest:
          type: boolean
        source:
          type: string
      required: [source]
    StrategyModuleResolution:
      type: object
      properties:
        name:
          type: string
        hash:
          type: string
        tag:
          type: string
        alias:
          type: string
        file:
          type: string
        path:
          type: string
    StrategyModuleOperationResponse:
      type: object
      properties:
        filename:
          type: string
        status:
          type: string
        strategyDirectory:
          type: string
        module:
          $ref: '#/components/schemas/StrategyModuleResolution'
          nullable: true
      required: [status, strategyDirectory]
    StrategyRefreshRequest:
      type: object
      properties:
        hashes:
          type: array
          items:
            type: string
        strategies:
          type: array
          items:
            type: string
    StrategyRefreshResult:
      type: object
      properties:
        selector:
          type: string
        strategy:
          type: string
        hash:
          type: string
        previousHash:
          type: string
        instances:
          type: array
          items:
            type: string
        reason:
          type: string
      required: [selector]
    StrategyRefreshResponse:
      type: object
      properties:
        status:
          type: string
        results:
          type: array
          items:
            $ref: '#/components/schemas/StrategyRefreshResult'
      required: [status]
    ProviderSettings:
      type: object
      additionalProperties: true
    ProviderStatus:
      type: string
      enum: [pending, starting, running, stopped, failed]
    Provider:
      type: object
      properties:
        name:
          type: string
        adapter:
          type: string
        identifier:
          type: string
        instrumentCount:
          type: integer
        settings:
          $ref: '#/components/schemas/ProviderSettings'
        running:
          type: boolean
        status:
          $ref: '#/components/schemas/ProviderStatus'
        startupError:
          type: string
        dependentInstances:
          type: array
          nullable: true
          items:
            type: string
        dependentInstanceCount:
          type: integer
          nullable: true
      required: [name, adapter, identifier, instrumentCount, settings, running, status]
    Instrument:
      type: object
      properties:
        symbol:
          type: string
        type:
          type: string
        baseAsset:
          type: string
          nullable: true
        baseCurrency:
          type: string
          nullable: true
        quoteAsset:
          type: string
          nullable: true
        quoteCurrency:
          type: string
          nullable: true
        venue:
          type: string
          nullable: true
        expiry:
          type: string
          nullable: true
        contractValue:
          type: number
          nullable: true
    ProviderDetail:
      allOf:
        - $ref: '#/components/schemas/Provider'
        - type: object
          properties:
            instruments:
              type: array
              items:
                $ref: '#/components/schemas/Instrument'
            adapter:
              $ref: '#/components/schemas/AdapterMetadata'
    ProvidersResponse:
      type: object
      properties:
        providers:
          type: array
          items:
            $ref: '#/components/schemas/Provider'
      required: [providers]
    ProviderRequest:
      type: object
      properties:
        name:
          type: string
        adapter:
          type: object
          properties:
            identifier:
              type: string
            config:
              type: object
              additionalProperties: true
          required: [identifier, config]
        enabled:
          type: boolean
      required: [name, adapter]
    ProviderSymbols:
      type: object
      properties:
        symbols:
          type: array
          items:
            type: string
      required: [symbols]
    AdapterMetadata:
      type: object
      properties:
        identifier:
          type: string
        displayName:
          type: string
        venue:
          type: string
        description:
          type: string
        capabilities:
          type: array
          items:
            type: string
        settingsSchema:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
              default:
                nullable: true
              description:
                type: string
                nullable: true
              required:
                type: boolean
            required: [name, type, required]
      required: [identifier, displayName, venue, capabilities, settingsSchema]
    AdaptersResponse:
      type: object
      properties:
        adapters:
          type: array
          items:
            $ref: '#/components/schemas/AdapterMetadata'
      required: [adapters]
    LambdaStrategySpec:
      type: object
      properties:
        identifier:
          type: string
        selector:
          type: string
        tag:
          type: string
        hash:
          type: string
        config:
          type: object
          additionalProperties: true
      required: [identifier, config]
    InstanceLinks:
      type: object
      properties:
        self:
          type: string
        usage:
          type: string
    ModuleRevisionUsage:
      type: object
      properties:
        strategy:
          type: string
        hash:
          type: string
        instances:
          type: array
          nullable: true
          items:
            type: string
        count:
          type: integer
        firstSeen:
          type: string
          format: date-time
          nullable: true
        lastSeen:
          type: string
          format: date-time
          nullable: true
        running:
          type: boolean
      required: [strategy, hash, count]
    InstanceSummary:
      type: object
      properties:
        id:
          type: string
        strategyIdentifier:
          type: string
        strategyTag:
          type: string
        strategyHash:
          type: string
        strategySelector:
          type: string
        providers:
          type: array
          items:
            type: string
        aggregatedSymbols:
          type: array
          items:
            type: string
        running:
          type: boolean
        baseline:
          type: boolean
        dynamic:
          type: boolean
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
        metadata:
          type: object
          additionalProperties: true
          nullable: true
        usage:
          $ref: '#/components/schemas/ModuleRevisionUsage'
        links:
          $ref: '#/components/schemas/InstanceLinks'
      required: [id, strategyIdentifier, providers, aggregatedSymbols, running]
    InstanceSpec:
      type: object
      properties:
        id:
          type: string
        strategy:
          $ref: '#/components/schemas/LambdaStrategySpec'
        scope:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ProviderSymbols'
        providers:
          type: array
          items:
            type: string
        aggregatedSymbols:
          type: array
          items:
            type: string
        running:
          type: boolean
      required: [id, strategy, scope]
    InstancesResponse:
      type: object
      properties:
        instances:
          type: array
          items:
            $ref: '#/components/schemas/InstanceSummary'
      required: [instances]
    InstanceActionResponse:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        action:
          type: string
          enum: [start, stop]
      required: [id, status, action]
    OrderRecord:
      type: object
      properties:
        id:
          type: string
        provider:
          type: string
        strategyInstance:
          type: string
        clientOrderId:
          type: string
        symbol:
          type: string
        side:
          type: string
        type:
          type: string
        quantity:
          type: string
        price:
          type: string
          nullable: true
        state:
          type: string
        externalReference:
          type: string
          nullable: true
        placedAt:
          type: integer
        metadata:
          type: object
          additionalProperties: true
        acknowledgedAt:
          type: integer
          nullable: true
        completedAt:
          type: integer
          nullable: true
        createdAt:
          type: integer
        updatedAt:
          type: integer
      required: [id, provider, strategyInstance, clientOrderId, symbol, side, type, quantity, state, placedAt, createdAt, updatedAt]
    OrderHistoryResponse:
      type: object
      properties:
        orders:
          type: array
          items:
            $ref: '#/components/schemas/OrderRecord'
        count:
          type: integer
      required: [orders, count]
    ExecutionRecord:
      type: object
      properties:
        orderId:
          type: string
        provider:
          type: string
        strategyInstance:
          type: string
        executionId:
          type: string
        quantity:
          type: string
        price:
          type: string
        fee:
          type: string
          nullable: true
        feeAsset:
          type: string
          nullable: true
        liquidity:
          type: string
          nullable: true
        tradedAt:
          type: integer
        metadata:
          type: object
          additionalProperties: true
        createdAt:
          type: integer
      required: [orderId, provider, strategyInstance, executionId, quantity, price, tradedAt, createdAt]
    ExecutionHistoryResponse:
      type: object
      properties:
        executions:
          type: array
          items:
            $ref: '#/components/schemas/ExecutionRecord'
        count:
          type: integer
      required: [executions, count]
    BalanceRecord:
      type: object
      properties:
        provider:
          type: string
        asset:
          type: string
        total:
          type: string
        available:
          type: string
        snapshotAt:
          type: integer
        metadata:
          type: object
          additionalProperties: true
        createdAt:
          type: integer
        updatedAt:
          type: integer
      required: [provider, asset, total, available, snapshotAt, createdAt, updatedAt]
    BalanceHistoryResponse:
      type: object
      properties:
        balances:
          type: array
          items:
            $ref: '#/components/schemas/BalanceRecord'
        count:
          type: integer
      required: [balances, count]
    StrategyModuleUsageResponse:
      type: object
      properties:
        selector:
          type: string
        strategy:
          type: string
        hash:
          type: string
        usage:
          $ref: '#/components/schemas/ModuleRevisionUsage'
        instances:
          type: array
          items:
            $ref: '#/components/schemas/InstanceSummary'
        total:
          type: integer
        offset:
          type: integer
        limit:
          type: integer
          nullable: true
      required: [selector, strategy, hash, usage, instances, total, offset]
    StrategyRegistryExport:
      type: object
      properties:
        registry:
          type: object
          additionalProperties:
            type: object
            required: [tags, hashes]
            properties:
              tags:
                type: object
                additionalProperties:
                  type: string
              hashes:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    tag:
                      type: string
                    path:
                      type: string
                  required: [tag, path]
        usage:
          type: array
          items:
            $ref: '#/components/schemas/ModuleRevisionUsage'
      required: [registry, usage]
    RiskConfig:
      type: object
      properties:
        maxPositionSize:
          type: string
        maxNotionalValue:
          type: string
        notionalCurrency:
          type: string
        orderThrottle:
          type: integer
        orderBurst:
          type: integer
        maxConcurrentOrders:
          type: integer
        priceBandPercent:
          type: number
        allowedOrderTypes:
          type: array
          items:
            type: string
        killSwitchEnabled:
          type: boolean
        maxRiskBreaches:
          type: integer
        circuitBreaker:
          type: object
          properties:
            enabled:
              type: boolean
            threshold:
              type: number
            cooldown:
              type: string
          required: [enabled, threshold, cooldown]
      required: [maxPositionSize, maxNotionalValue, notionalCurrency, orderThrottle, orderBurst, maxConcurrentOrders, priceBandPercent, allowedOrderTypes, killSwitchEnabled, maxRiskBreaches, circuitBreaker]
    ContextBackupPayload:
      type: object
      properties:
        providers:
          type: array
          items:
            type: object
            additionalProperties: true
        lambdas:
          type: array
          items:
            $ref: '#/components/schemas/InstanceSpec'
        risk:
          $ref: '#/components/schemas/RiskConfig'
      required: [providers, lambdas, risk]
    RestoreContextResponse:
      type: object
      properties:
        status:
          type: string
      required: [status]
    OutboxQuery:
      type: object
      properties:
        limit:
          type: integer
    OutboxEvent:
      type: object
      properties:
        id:
          type: integer
        aggregateType:
          type: string
        aggregateID:
          type: string
        eventType:
          type: string
        payload:
          type: object
          additionalProperties: true
        headers:
          type: object
          additionalProperties: true
        availableAt:
          type: string
        publishedAt:
          type: string
          nullable: true
        attempts:
          type: integer
        lastError:
          type: string
          nullable: true
        delivered:
          type: boolean
        createdAt:
          type: string
      required: [id, aggregateType, aggregateID, eventType, payload, headers, availableAt, attempts, delivered, createdAt]
    OutboxListResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/OutboxEvent'
        count:
          type: integer
      required: [events, count]
    OutboxDeleteResponse:
      type: object
      properties:
        id:
          type: integer
        status:
          type: string
      required: [id, status]
    ApiErrorPayload:
      type: object
      properties:
        error:
          type: string
        details:
          type: object
          additionalProperties: true
      required: [error]
